<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Details - Normalitylb</title>
<link rel="stylesheet" href="styles.css">

<style>
/* ===== TABS ===== */
.tabs { margin-top: 25px; }
.tab-buttons { display: flex; gap: 10px; margin-bottom: 10px; }
.tab-buttons button {
  padding: 8px 15px;
  border: none;
  cursor: pointer;
  border-radius: 6px;
  background: #eee;
}
.tab-buttons button.active {
  background: #c3026c;
  color: #fff;
}
.tab-content {
  display: none;
  background: #f9f9f9;
  padding: 15px;
  border-radius: 8px;
}
.tab-content.active { display: block; }

/* ===== VARIANTS ===== */
.variants {
  display: flex;
  gap: 12px;
  margin-top: 15px;
}
.variant-option {
  text-align: center;
  cursor: pointer;
}
.variant-option img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 10px;
}
.variant-option.out {
  opacity: 0.4;
}
.out-of-stock {
  color: red;
  font-weight: bold;
  margin-top: 6px;
  font-size: 13px;
}
</style>
</head>

<body style="padding-top:120px;">

<div class="container" id="detailsContainer"></div>

<script>
const product = JSON.parse(localStorage.getItem("selectedProduct"));
const container = document.getElementById("detailsContainer");
let selectedVariant = null;

if (!product) {
  container.innerHTML = "<h2>No product found</h2>";
} else {

  let mainImage = product.image;
  let titleText = product.name;
  let inStock = product.stock === "available";
  let variantsHTML = "";

  /* ===== VARIANTS ===== */
  if (product.variants && product.variants.length > 0) {
    selectedVariant = product.variants[0];
    mainImage = selectedVariant.image;
    titleText = product.name + " - " + selectedVariant.name;
    inStock = selectedVariant.stock === "available";

    variantsHTML = `
      <h4>Choose scent:</h4>
      <div class="variants">
        ${product.variants.map(v => `
          <div class="variant-option ${v.stock === "out" ? "out" : ""}"
               onclick="changeVariant('${v.image}','${v.name}','${v.stock}')">
            <img src="${v.image}">
            <small>${v.name}</small>
            ${v.stock === "out" ? `<div class="out-of-stock">Out of Stock</div>` : ""}
          </div>
        `).join("")}
      </div>
    `;
  }

  container.innerHTML = `
    <a href="products.html" class="back-btn">‚Üê Back to products</a>

    <div class="product-details-wrapper">
      <div>
        <img id="mainImage" src="${mainImage}" class="product-details-image">
        ${variantsHTML}
      </div>

      <div class="product-details-info">
        <h2 id="productTitle">${titleText}</h2>
        <p>${product.description}</p>
        <h3>${product.price || ""}</h3>

        <div class="tabs">
          <div class="tab-buttons">
            <button class="tab-btn active" data-tab="use">How to use</button>
            <button class="tab-btn" data-tab="ingredients">Ingredients</button>
            <button class="tab-btn" data-tab="benefits">Benefits</button>
          </div>

          <div id="use" class="tab-content active">
            ${product.howToUse || "No instructions available."}
          </div>
          <div id="ingredients" class="tab-content">
            ${product.ingredients || "No ingredients listed."}
          </div>
          <div id="benefits" class="tab-content">
            ${product.benefits || "No benefits listed."}
          </div>
        </div>

        <div id="stockArea">
          ${inStock
            ? `<button class="big-add-cart" onclick="addToCart()">Add to Cart</button>`
            : `<div class="out-of-stock">Out of Stock</div>`
          }
        </div>

      </div>
    </div>
  `;
}

/* ===== CHANGE VARIANT ===== */
function changeVariant(img, name, stock) {
  selectedVariant = { image: img, name: name, stock: stock };

  document.getElementById("mainImage").src = img;
  document.getElementById("productTitle").textContent =
    product.name + " - " + name;

  const stockArea = document.getElementById("stockArea");

  if (stock === "out") {
    stockArea.innerHTML = `<div class="out-of-stock">Out of Stock</div>`;
  } else {
    stockArea.innerHTML =
      `<button class="big-add-cart" onclick="addToCart()">Add to Cart</button>`;
  }
}

/* ===== ADD TO CART ===== */
function addToCart() {
  if (selectedVariant && selectedVariant.stock === "out") {
    alert("‚ùå This variant is out of stock");
    return;
  }

  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart.push({
    name: document.getElementById("productTitle").textContent,
    price: product.price,
    image: document.getElementById("mainImage").src
  });

  localStorage.setItem("cart", JSON.stringify(cart));
  alert("Added to cart üõí");
}

/* ===== TABS ===== */
document.addEventListener("click", e => {
  if (e.target.classList.contains("tab-btn")) {
    document.querySelectorAll(".tab-btn")
      .forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tab-content")
      .forEach(c => c.classList.remove("active"));

    e.target.classList.add("active");
    document.getElementById(e.target.dataset.tab)
      .classList.add("active");
  }
});
</script>

</body>
</html>
