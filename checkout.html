<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - Normalitylb</title>

<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0}
.checkout-wrapper{
max-width:980px;
margin:3.5rem auto;
padding:1.5rem;
display:grid;
grid-template-columns:1fr 380px;
gap:2rem;
}
.checkout-card{
background:#fff;
border-radius:1rem;
padding:1.25rem;
box-shadow:0 8px 25px rgba(0,0,0,.08);
}
.form-group{margin-bottom:1rem;}
.form-group label{display:block;font-weight:600;margin-bottom:.35rem;}
.form-group input,
.form-group textarea,
.form-group select{
width:100%;
padding:.7rem;
border:1px solid #d1d5db;
border-radius:.5rem;
}
.summary-item{
display:flex;
justify-content:space-between;
margin-bottom:.6rem;
}
.btn-place-order{
width:100%;
padding:1rem;
background:#c3026c;
color:#fff;
border:none;
border-radius:.6rem;
font-weight:700;
cursor:pointer;
margin-top:1rem;
}
</style>
</head>

<body>

<main>
<h1 style="text-align:center;margin-top:2rem">Checkout</h1>

<div class="checkout-wrapper">

<!-- FORM -->
<div class="checkout-card">
<h2 style="color:#c3026c">Shipping & Contact</h2>

<form id="checkoutForm">
<div class="form-group">
<label>Full name</label>
<input id="fullName" required>
</div>

<div class="form-group">
<label>Phone</label>
<input id="phone" required>
</div>

<div class="form-group">
<label>City</label>
<input id="city" required>
</div>

<div class="form-group">
<label>Address</label>
<input id="address" required>
</div>

<div class="form-group">
<label>Notes</label>
<textarea id="notes"></textarea>
</div>

<div class="form-group">
<label>Promo code</label>
<input id="promoCode">
</div>

<div class="form-group">
<label>Delivery method</label>
<select id="paymentMethod">
<option value="cash">Cash on delivery (+$4)</option>
<option value="pickup">Pickup from Dbaye (Free)</option>
</select>
</div>

<button class="btn-place-order" type="submit">Place Order</button>
</form>
</div>

<!-- SUMMARY -->
<aside class="checkout-card">
<h3>Order Summary</h3>

<div id="summaryItems"></div>
<hr>

<div class="summary-item">
<strong>Subtotal</strong>
<span id="subtotal">$0.00</span>
</div>

<div class="summary-item">
<strong>Shipping</strong>
<span id="shipping">$0.00</span>
</div>

<div class="summary-item" style="font-size:1.2rem">
<strong>Total</strong>
<strong id="total" style="color:#c3026c">$0.00</strong>
</div>
</aside>

</div>
</main>

<script>
const WHATSAPP_NUMBER = "96176370139";
const PROMO_CODE = "FIRST10";

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let discount = 0;

function price(v){return parseFloat(String(v).replace(/[^0-9.]/g,""))||0;}

function renderSummary(){
let subtotal=0;
let itemsHTML="";
cart.forEach(i=>{
let p=price(i.price);
subtotal+=p;
itemsHTML+=`<div class="summary-item"><span>${i.name}</span><span>$${p.toFixed(2)}</span></div>`;
});
document.getElementById("summaryItems").innerHTML=itemsHTML;
document.getElementById("subtotal").textContent="$"+subtotal.toFixed(2);
calcTotal(subtotal);
}

function calcTotal(subtotal){
let shipping=document.getElementById("paymentMethod").value==="cash"?4:0;
let total=subtotal-(subtotal*discount)+shipping;
document.getElementById("shipping").textContent=shipping?"$4.00":"Free";
document.getElementById("total").textContent="$"+total.toFixed(2);
return total;
}

document.getElementById("promoCode").addEventListener("input",e=>{
discount=e.target.value.trim().toUpperCase()===PROMO_CODE?0.1:0;
renderSummary();
});

document.getElementById("paymentMethod").addEventListener("change",renderSummary);

document.getElementById("checkoutForm").addEventListener("submit",e=>{
e.preventDefault();
if(cart.length===0){alert("Cart empty");return;}

let subtotal=cart.reduce((s,i)=>s+price(i.price),0);
let shipping=document.getElementById("paymentMethod").value==="cash"?4:0;
let total=subtotal-(subtotal*discount)+shipping;

let itemsText=cart.map(i=>`- ${i.name} ($${price(i.price).toFixed(2)})`).join("\n");

let msg=`ðŸ›’ *New Order*
Name: ${fullName.value}
Phone: ${phone.value}
City: ${city.value}
Address: ${address.value}
Notes: ${notes.value || "None"}

*Items*
${itemsText}

Subtotal: $${subtotal.toFixed(2)}
Discount: ${discount*100}%
Shipping: $${shipping.toFixed(2)}
Total: $${total.toFixed(2)}`;

let url=`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;

localStorage.removeItem("cart");
window.location.href=url;
});

renderSummary();
</script>

</body>
</html>
